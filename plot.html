<head>
  <!-- Plotly.js -->
  <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="plotly-latest.min.js"></script>
  <script src="shelling-2.js"></script>
  <script src="node_modules/seedrandom/seedrandom.min.js"></script>
  <link href="style.css" rel="stylesheet" type="text/css">

</head>

<body>
  <div style="text-align: right">
    <div>
      <label for="seedText">Seed:</label><input type="text" id="seedText" />
    </div>
    <div>
      <label for="xtimesText">Number of Times:</label
      ><input type="text" id="xtimesText" />
    </div>
    <div>
      <label for="cityHeight">Size of City (Square):</label
      ><input type="text" id="cityHeight" />
    </div>
    <div>
      <label for="occupancyText">Occupancy:</label
      ><input type="text" id="occupancyText" />
    </div>

    <div>
      <label for="segmentThresholdText">Threshold:</label
      ><input type="text" id="segmentThresholdText" />
    </div>
    <div>
      <span>
        <label for="propAText">Proportion A:</label
        ><input type="text" id="propAText" />
        <label for="propBText">Proportion B:</label
        ><input type="text" id="propBText" />
      </span>
    </div>
    <button type="button" id="runPlot" onclick="runPlot()">Click Me!</button>
  </div>

  <div>
    <div id="myDiv"><!-- Plotly chart will be drawn inside this DIV --></div>
    <div id="myDiv2"><!-- Plotly chart will be drawn inside this DIV --></div>
    <div>
      <label for="seedDiv">Seed:</label>
      <span id="seedDiv"></span>
    </div>
    <div>
      <label for="iterationsDiv">Iterations:</label>
      <span id="iterationsDiv"></span>
    </div>
    <div>
      <label for="segregationDiv">Segregation:</label>
      <span id="segregationDiv"></span>
    </div>
    <div>
      <label for="paramsDiv">params = </label>
      <span id="paramsDiv"></span>
    </div>
    <div id="myDiv3"><!-- Plotly chart will be drawn inside this DIV --></div>
  </div>

  <script>
    var params = {
      runXtimes: 1,
      cityHeight: 30,
      cityWidth: 30,
      occupancy: 0.9,
      populationProportions: [0, 0.6, 0.4],
      segmentRatio: 0.5,
      seed: ""
    };

    params = {
      runXtimes: "1",
      cityHeight: 30,
      cityWidth: 30,
      occupancy: "0.9",
      populationProportions: [0, "0.6", "0.4"],
      segmentRatio: "0.5",
      seed: "hi"
    };

    //params = {"runXtimes":"1","cityHeight":30,"cityWidth":30,"occupancy":"0.9","populationProportions":[0,"0.6","0.4"],"segmentRatio":"0.5","seed":"0.06499457532532817"}
    // params = {"runXtimes":"1","cityHeight":30,"cityWidth":30,"occupancy":"0.9","populationProportions":[0,"0.6","0.4"],"segmentRatio":"0.5","seed":"0.8570219478381559"}

    // Make randomness repeatable
    var seedString;
    if (params.seed === "") seedString = "hello";
    else seedString = params.seed;

    $("#seedText").val(seedString);
    $("#xtimesText").val(params.runXtimes);
    $("#cityHeight").val(params.cityHeight);
    $("#occupancyText").val(params.occupancy);
    $("#segmentThresholdText").val(params.segmentRatio);
    $("#propAText").val(params.populationProportions[1]);
    $("#propBText").val(params.populationProportions[2]);

    function graphPlot(divName, mat) {
      //var [howLong, segmentedCount] = runShelling(cityMat, params);

      // var histogram = runXtimes(params);

      var colorscaleValue = [[0, "#ffffff"], [0.5, "#001f3f"], [1, "#edf547"]];
      var data = [
        {
          z: mat,
          type: "heatmap",
          colorscale: colorscaleValue,
          showscale: false,
          showticklabels: false
        }
      ];

      var axisTemplate = {
        // range: [0, 1.6],
        // autorange: false,
        showgrid: false,
        zeroline: false,
        linecolor: "black",
        showticklabels: false,
        ticks: ""
      };

      var layout = {
        //title: "Heatmap with Unequal Block Sizes",
        margin: {
          t: 20,
          r: 20,
          b: 20,
          l: 20
        },
        showlegend: false,
        xaxis: axisTemplate,
        yaxis: axisTemplate,
        width: 350,
        height: 350,
        autosize: false
      };

      Plotly.newPlot(divName, data, layout, { showSendToCloud: false });
    }

    function linePlot(divName, x_array, y_array) {
      var trace1 = {
        x: x_array,
        y: y_array,
        name: "Segregated Households",
        mode: "lines+markers",
        type: "scatter"
      };

      var data = [trace1];

      var layout = {
        //title: "Heatmap with Unequal Block Sizes",
        margin: {
          t: 60,
          r: 60,
          b: 60,
          l: 60
        },
        // showlegend: true,
        // xaxis: axisTemplate,
        // yaxis: axisTemplate,
        width: 600,
        height: 400,
        autosize: false,
  title: {
    text:'Segregated Households',
    // font: {
      // family: 'Courier New, monospace',
      // size: 24
    // },
    xref: 'paper',
    x: 0.05,
  },
  xaxis: {
    automargin: true,
    title: {
      text: 'Iterations',
      font: {
        // family: 'Courier New, monospace',
        size: 18,
        color: '#7f7f7f'
      }
    },
  },
  yaxis: {
    automargin: true,
    title: {
      text: 'segragated households',
      font: {
        // family: 'Courier New, monospace',
        size: 18,
        color: '#7f7f7f'
      }
    }
  }

      };

      Plotly.newPlot(divName, data, layout);
    }

    function runPlot() {

      if ($("#cityHeight").val() !== "") {
        params.cityHeight = parseInt($("#cityHeight").val());
        params.cityWidth = params.cityHeight;
      }

      var cityMat = Array(params.cityHeight)
        .fill()
        .map(() => Array(params.cityWidth).fill(0));

      var mat = Array(params.cityHeight)
        .fill()
        .map(() => Array(params.cityWidth).fill(0));

      if ($("#seedText").val() !== "") {
        params.seed = seedString = $("#seedText").val();
      }

      if ($("#xtimesText").val() !== "") {
        params.runXtimes = $("#xtimesText").val();
      }

      
      if ($("#occupancyText").val() !== "") {
        params.occupancy = $("#occupancyText").val();
      }
      if ($("#segmentThresholdText").val() !== "") {
        params.segmentRatio = $("#segmentThresholdText").val();
      }
      if ($("#propAText").val() !== "") {
        params.populationProportions[1] = $("#propAText").val();
      }
      if ($("#propBText").val() !== "") {
        params.populationProportions[2] = $("#propBText").val();
      }

      $("#seedDiv").text(seedString);
      Math.seedrandom(seedString);
      $("#seedText").val(Math.random());

      populate(cityMat, params);
      graphPlot("myDiv", cityMat);
      var [numberofInterations, segregation] = runShelling(cityMat, params);


      $("#paramsDiv").text(JSON.stringify(params));
      graphPlot("myDiv2", cityMat);
      linePlot("myDiv3", [...segregation.keys()], [...segregation]);

      $("#iterationsDiv").text(numberofInterations);
      $("#segregationDiv").text(
        segregation.pop() / (params.cityHeight * params.cityWidth)
      );

    }

    runPlot()
  </script>
</body>
